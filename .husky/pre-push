set -euo pipefail

root="$(git rev-parse --show-toplevel)"
cd "$root"

# Generate repo mix and stage changes
bunx repomix .
git add .

if git rev-parse --verify origin/main >/dev/null 2>&1; then
  bun run typecheck:changed
  # bun run test:changed     # enable once tests exist
else
  bun run check-types
  # bun run test             # enable once tests exist
fi
